#!/bin/bash
#BSUB -J test 	# the job name
#BSUB -n 8 	# the number of CPU cores over all hosts
#BSUB -R span[ptile=2]
#BSUB -M 1000MB 	# The amount of memory in MB
#BSUB -W 1:00 	# Duration of the program
#BSUB -q batch_a100 	# Which queue to run on
#BSUB -o /home/sav1pi/projects/submitit/test/dir/%x.%j.out 	# Logfile for stdout
#BSUB -e /home/sav1pi/projects/submitit/test/dir/%x.%j.err 	# Logfile for stderr

# prevent LSF from dumping it's RAM when job crashes
ulimit -S -c 0
# Exit the script upon any error
set -e

# Workaround for environment variables: see https://bit.ly/3wPvWNt
source /fs/applications/modules/current/init/bash
# This avoids issues with conda init code inside `.bashrc.`
conda deactivate &>/dev/null || true
if ! module purge; then
  echo "Error purging modules, continuing anyway." >&2
fi

module load 
module list --redirect --terse

# Run the main command
test.py
set +e
